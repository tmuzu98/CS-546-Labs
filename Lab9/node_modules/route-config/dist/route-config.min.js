!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).RouteConfig={})}(this,function(e){"use strict";var t=function(){function e(e){if("string"!=typeof e)throw new TypeError("Config: name must be a string");this._name=e}var t=e.prototype;return t.isConfig=function(){return!0},t.merge=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return Object.assign.apply(Object,[{}].concat(t))},t.name=function(){return this._name},t.set=function(e){return Object.assign({},e)},e}();function c(i){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},t=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),t.forEach(function(e){var t,n,r;r=o[n=e],n in(t=i)?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r})}return i}var o=f,n=function(e,t){return u(a(e,t))},r=u,i=s,j="/",O=/(\\.)|(?:\:(\w+)(?:\(((?:\\.|[^\\()])+)\))?|\(((?:\\.|[^\\()])+)\))([+*?])?/g;function a(e,t){for(var n,r,i=[],o=0,a=0,u="",s=t&&t.delimiter||j,c=t&&t.whitelist||void 0,f=!1;null!==(n=O.exec(e));){var p=n[0],h=n[1],l=n.index;if(u+=e.slice(a,l),a=l+p.length,h)u+=h[1],f=!0;else{var y="",m=n[2],g=n[3],d=n[4],v=n[5];if(!f&&u.length){var b=u.length-1,w=u[b];(!c||-1<c.indexOf(w))&&(y=w,u=u.slice(0,b))}u&&(i.push(u),u="",f=!1);var E=g||d,k=y||s;i.push({name:m||o++,prefix:y,delimiter:k,optional:"?"===v||"*"===v,repeat:"+"===v||"*"===v,pattern:E?(r=E,r.replace(/([=!:$/()])/g,"\\$1")):"[^"+_(k===s?k:k+s)+"]+?"})}}return(u||a<e.length)&&i.push(u+e.substr(a)),i}function u(c){for(var f=Array(c.length),e=0;e<c.length;e++)"object"==typeof c[e]&&(f[e]=RegExp("^(?:"+c[e].pattern+")$"));return function(e,t){for(var n="",r=t&&t.encode||encodeURIComponent,i=0;i<c.length;i++){var o=c[i];if("string"!=typeof o){var a,u=e?e[o.name]:void 0;if(Array.isArray(u)){if(!o.repeat)throw new TypeError('Expected "'+o.name+'" to not repeat, but got array');if(0===u.length){if(o.optional)continue;throw new TypeError('Expected "'+o.name+'" to not be empty')}for(var s=0;s<u.length;s++){if(a=r(u[s],o),!f[i].test(a))throw new TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'"');n+=(0===s?o.prefix:o.delimiter)+a}}else if("string"!=typeof u&&"number"!=typeof u&&"boolean"!=typeof u){if(!o.optional)throw new TypeError('Expected "'+o.name+'" to be '+(o.repeat?"an array":"a string"))}else{if(a=r(u+"",o),!f[i].test(a))throw new TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but got "'+a+'"');n+=o.prefix+a}}else n+=o}return n}}function _(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function y(e){return e&&e.sensitive?"":"i"}function s(e,t,n){for(var r=(n=n||{}).strict,i=!1!==n.start,o=!1!==n.end,a=n.delimiter||j,u=[].concat(n.endsWith||[]).map(_).concat("$").join("|"),s=i?"^":"",c=0;c<e.length;c++){var f=e[c];if("string"==typeof f)s+=_(f);else{var p=f.repeat?"(?:"+f.pattern+")(?:"+_(f.delimiter)+"(?:"+f.pattern+"))*":f.pattern;t&&t.push(f),s+=f.optional?f.prefix?"(?:"+_(f.prefix)+"("+p+"))?":"("+p+")?":_(f.prefix)+"("+p+")"}}if(o)r||(s+="(?:"+_(a)+")?"),s+="$"===u?"$":"(?="+u+")";else{var h=e[e.length-1],l="string"==typeof h?h[h.length-1]===a:void 0===h;r||(s+="(?:"+_(a)+"(?="+u+"))?"),l||(s+="(?="+_(a)+"|"+u+")")}return RegExp(s,y(n))}function f(e,t,n){return e instanceof RegExp?function(e,t){if(!t)return e;var n=e.source.match(/\((?!\?)/g);if(n)for(var r=0;r<n.length;r++)t.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return e}(e,t):Array.isArray(e)?function(e,t,n){for(var r=[],i=0;i<e.length;i++)r.push(f(e[i],t,n).source);return RegExp("(?:"+r.join("|")+")",y(n))}(e,t,n):function(e,t,n){return s(a(e,n),t,n)}(e,t,n)}function p(e){return!(!e||"function"!=typeof e.hasOwnProperty||!(e.hasOwnProperty("__ownerID")||e._map&&e._map.hasOwnProperty("__ownerID")))}function h(r,e,i){return Object.keys(r).reduce(function(e,t){var n=""+t;return e.has(n)?e.set(n,i(e.get(n),r[n])):e},e)}o.parse=a,o.compile=n,o.tokensToFunction=r,o.tokensToRegExp=i;var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},g=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},b=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},w=function(){function c(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(m(this,c),!e||"string"!=typeof e)throw Error("Expected a string key for Entity, but found "+e+".");var r=n.idAttribute,i=void 0===r?"id":r,o=n.mergeStrategy,a=void 0===o?function(e,t){return d({},e,t)}:o,u=n.processStrategy,s=void 0===u?function(e){return d({},e)}:u;this._key=e,this._getId="function"==typeof i?i:function(t){return function(e){return p(e)?e.get(t):e[t]}}(i),this._idAttribute=i,this._mergeStrategy=a,this._processStrategy=s,this.define(t)}return c.prototype.define=function(r){this.schema=Object.keys(r).reduce(function(e,t){var n;return d({},e,((n={})[t]=r[t],n))},this.schema||{})},c.prototype.getId=function(e,t,n){return this._getId(e,t,n)},c.prototype.merge=function(e,t){return this._mergeStrategy(e,t)},c.prototype.normalize=function(e,t,n,r,i){var o=this,a=this._processStrategy(e,t,n);return Object.keys(this.schema).forEach(function(e){a.hasOwnProperty(e)&&"object"===l(a[e])&&(a[e]=r(a[e],a,e,o.schema[e],i))}),i(this,a,e,t,n),this.getId(e,t,n)},c.prototype.denormalize=function(t,n){var r=this;return p(t)?h(this.schema,t,n):(Object.keys(this.schema).forEach(function(e){t.hasOwnProperty(e)&&(t[e]=n(t[e],r.schema[e]))}),t)},g(c,[{key:"key",get:function(){return this._key}},{key:"idAttribute",get:function(){return this._idAttribute}}]),c}(),E=function(){function n(e,t){m(this,n),t&&(this._schemaAttribute="string"==typeof t?function(e){return e[t]}:t),this.define(e)}return n.prototype.define=function(e){this.schema=e},n.prototype.getSchemaAttribute=function(e,t,n){return!this.isSingleSchema&&this._schemaAttribute(e,t,n)},n.prototype.inferSchema=function(e,t,n){if(this.isSingleSchema)return this.schema;var r=this.getSchemaAttribute(e,t,n);return this.schema[r]},n.prototype.normalizeValue=function(e,t,n,r,i){var o=this.inferSchema(e,t,n);if(!o)return e;var a=r(e,t,n,o,i);return this.isSingleSchema||null==a?a:{id:a,schema:this.getSchemaAttribute(e,t,n)}},n.prototype.denormalizeValue=function(e,t){var n=p(e)?e.get("schema"):e.schema;return this.isSingleSchema||n?t((p(e)?e.get("id"):e.id)||e,this.isSingleSchema?this.schema:this.schema[n]):e},g(n,[{key:"isSingleSchema",get:function(){return!this._schemaAttribute}}]),n}(),k=function(n){function r(e,t){if(m(this,r),!t)throw Error('Expected option "schemaAttribute" not found on UnionSchema.');return b(this,n.call(this,e,t))}return v(r,n),r.prototype.normalize=function(e,t,n,r,i){return this.normalizeValue(e,t,n,r,i)},r.prototype.denormalize=function(e,t){return this.denormalizeValue(e,t)},r}(E),A=function(e){function t(){return m(this,t),b(this,e.apply(this,arguments))}return v(t,e),t.prototype.normalize=function(o,e,t,a,u){var s=this;return Object.keys(o).reduce(function(e,t,n){var r,i=o[t];return null!=i?d({},e,((r={})[t]=s.normalizeValue(i,o,t,a,u),r)):e},{})},t.prototype.denormalize=function(r,i){var o=this;return Object.keys(r).reduce(function(e,t){var n;return d({},e,((n={})[t]=o.denormalizeValue(r[t],i),n))},{})},t}(E),x=function(e){if(Array.isArray(e)&&1<e.length)throw Error("Expected schema definition to be a single schema, but found "+e.length+".");return e[0]},S=function(t){return Array.isArray(t)?t:Object.keys(t).map(function(e){return t[e]})},z=function(n,e,r,i,o,a){return n=x(n),S(e).map(function(e,t){return o(e,r,i,n,a)})},R=function(t,e,n){return t=x(t),e&&e.map?e.map(function(e){return n(e,t)}):e},P=function(e){function t(){return m(this,t),b(this,e.apply(this,arguments))}return v(t,e),t.prototype.normalize=function(e,n,r,i,o){var a=this;return S(e).map(function(e,t){return a.normalizeValue(e,n,r,i,o)}).filter(function(e){return null!=e})},t.prototype.denormalize=function(e,t){var n=this;return e&&e.map?e.map(function(e){return n.denormalizeValue(e,t)}):e},t}(E),C=function(n,r,e,t,i,o){var a=d({},r);return Object.keys(n).forEach(function(e){var t=i(r[e],r,e,n[e],o);null==t?delete a[e]:a[e]=t}),a},T=function(t,e,n){if(p(e))return h(t,e,n);var r=d({},e);return Object.keys(t).forEach(function(e){r[e]&&(r[e]=n(r[e],t[e]))}),r},M=function(){function t(e){m(this,t),this.define(e)}return t.prototype.define=function(r){this.schema=Object.keys(r).reduce(function(e,t){var n;return d({},e,((n={})[t]=r[t],n))},this.schema||{})},t.prototype.normalize=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return C.apply(void 0,[this.schema].concat(t))},t.prototype.denormalize=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return T.apply(void 0,[this.schema].concat(t))},t}(),I={Array:P,Entity:w,Object:M,Union:k,Values:A},V=function(e,t){if(!e||"object"!==(void 0===e?"undefined":l(e)))throw Error('Unexpected input given to normalize. Expected type to be "object", found "'+(void 0===e?"undefined":l(e))+'".');var n={};return{entities:n,result:function e(t,n,r,i,o){return"object"===(void 0===t?"undefined":l(t))&&t?"object"!==(void 0===i?"undefined":l(i))||i.normalize&&"function"==typeof i.normalize?i.normalize(t,n,r,e,o):(Array.isArray(i)?z:C)(i,t,n,r,e,o):t}(e,e,null,t,function(s){return function(e,t,n,r,i){var o=e.key,a=e.getId(n,r,i);o in s||(s[o]={});var u=s[o][a];s[o][a]=u?e.merge(u,t):t}}(n))}},$=function(e){var r={},i=N(e);return function e(t,n){return"object"!==(void 0===n?"undefined":l(n))||n.denormalize&&"function"==typeof n.denormalize?null==t?t:n instanceof w?function(e,t,n,r,i){var o=r(e,t);if("object"!==(void 0===o?"undefined":l(o))||null===o)return o;if(i[t.key]||(i[t.key]={}),!i[t.key][e]){var a=p(o)?o:d({},o);i[t.key][e]=a,i[t.key][e]=t.denormalize(a,n)}return i[t.key][e]}(t,n,e,i,r):n.denormalize(t,e):(Array.isArray(n)?R:T)(n,t,e)}},N=function(r){var i=p(r);return function(e,t){var n=t.key;return"object"===(void 0===e?"undefined":l(e))?e:i?r.getIn([n,""+e]):r[n][e]}},U=function(){function e(e){var t=this;void 0===e&&(e=[]),this.configs=[],e.forEach(function(e){t.add(e)})}var t=e.prototype;return t.add=function(t){if(!t||!t.isConfig()||!t.name())throw new TypeError("ConfigManager(add): `config` must be a Config instance.");if(this.configs.find(function(e){return e.name()===t.name()}))throw Error("ConfigManager(add): config '"+t.name()+"' already exists");this.configs.push(t)},t.merge=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];var n=r.reduce(function(e,t){return t&&"object"==typeof t?c({},e,t):e},{});return this.configs.reduce(function(e,t){var n=t.name();return e[n]=t.merge.apply(t,r.map(function(e){return void 0===e&&(e={}),e[n]})),e},n)},t.set=function(r){void 0===r&&(r={});var e=r&&"object"==typeof r?c({},r):{};return this.configs.reduce(function(e,t){var n=t.name();return e[n]=t.set(r[n]),e},e)},e}(),D=function(e,t,n){return void 0===n&&(n=""),t?e&&"index"!==e?""+t+n+e:t:e},q=function(e){return e},F=function(){function f(e,t){void 0===t&&(t={}),this.configManager=new U(t.configs),this.keys={namespaces:[],routes:[]},this.namespaces={},this.options=t,this.routes={},this._initMap(e||{namespaces:{},routes:{}})}var e=f.prototype;return e._cloneAttributes=function(n){if(void 0===n&&(n=this),!n)return n;var e={};return n.config&&(e.config=this.configManager.set(n.config)),["fullPath","id","key","path"].reduce(function(e,t){return n[t]&&(e[t]=n[t]),e},e)},e._findRoute=function(e){var t,n=Array.isArray(e)?e:e.split(".");return 1===n.length?t=this.routes[e]||this.namespaces[e]&&this.namespaces[e]._findRoute("index"):1<n.length&&(t=this.namespaces[n[0]]&&this.namespaces[n[0]]._findRoute(n.slice(1))),t},e._getNormalizableMap=function(n){var r=this;void 0===n&&(n={});var i=n.filter,e=n.formatRoute,t=void 0===e?q:e,o=this._cloneAttributes();return o.namespaces=[],o.routes=[],this.keys.namespaces.forEach(function(e){if(!i||i(r.namespaces[e])){var t=r.namespaces[e]._getNormalizableMap(n);t&&o.namespaces.push(t)}}),this.keys.routes.forEach(function(e){i&&!i(r.routes[e])||o.routes.push(t(r._cloneAttributes(r.routes[e])))}),0<o.namespaces.length||0<o.routes.length?o:null},e._initMap=function(e){var t=this;if(!e)throw Error("RouteConfig: `map` is required.");var n=e.namespaces,r=void 0===n?{}:n,i=e.routes,o=void 0===i?{}:i,a=this._cloneAttributes(e);Object.keys(a).forEach(function(e){a[e]&&(t[e]=a[e])}),Object.keys(r).forEach(function(e){t.namespace(c({key:e},r[e]))}),Object.keys(o).forEach(function(e){t.route(c({key:e},o[e]))})},e.getMap=function(r){var i=this;void 0===r&&(r={});var o=r.filter,e=r.formatRoute,n=void 0===e?q:e,a=0,u=0,t=c({},this._cloneAttributes(),{namespaces:this.keys.namespaces.reduce(function(e,t){if(o&&!o(i.namespaces[t]))return e;var n=i.namespaces[t].getMap(r);return n&&(e[t]=n,a+=1),e},{}),routes:this.keys.routes.reduce(function(e,t){return o&&!o(i.routes[t])||(e[t]=n(i._cloneAttributes(i.routes[t])),u+=1),e},{})});return 0<a||0<u?t:null},e.getNormalizedMap=function(e){void 0===e&&(e={});var t=this._getNormalizableMap(e);if(!t)return null;var n=new I.Entity("routes"),r=new I.Entity("namespaces",{routes:[n]});return r.define({namespaces:[r]}),V(t,{namespaces:[r],routes:[n]})},e.getRoute=function(e){if("string"!=typeof e||""===e)throw new TypeError("RouteConfig(getRoute): `key` must be a non empty string.");return this._cloneAttributes(this._findRoute(e))},e.merge=function(){for(var s=this,e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(e){var t=e.config,n=e.namespaces,r=void 0===n?{}:n,i=e.routes,o=void 0===i?{}:i,a=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])<0&&(i[n]=e[n]);return i}(e,["config","namespaces","routes"]),u=s._cloneAttributes(c({config:t||s.config?s.configManager.merge(s.config||{},t||{}):void 0},a));Object.keys(u).forEach(function(e){u[e]&&(s[e]=u[e])}),Object.keys(r).forEach(function(e){var t=s.namespaces[e];t?t.merge(r[e]):s.namespace(c({},r[e],{key:e}))}),Object.keys(o).forEach(function(e){s.route(s._cloneAttributes(c({},o[e],{key:e,config:s.configManager.merge((s.routes[e]||{}).config||{},o[e].config||{})})))})})},e.namespace=function(e){var t=e.config,n=e.fullPath,r=e.id,i=e.key,o=e.namespaces,a=void 0===o?{}:o,u=e.path,s=e.routes,c=void 0===s?{}:s;if(n&&"string"!=typeof n)throw new TypeError("RouteConfig(namespace): `fullPath` must be a non empty string.");if(r&&"string"!=typeof r)throw new TypeError("RouteConfig(namespace): `id` must be a non empty string.");if("string"!=typeof i||""===i)throw new TypeError("RouteConfig(namespace): `key` must be a non empty string.");if("string"!=typeof u||""===u)throw new TypeError("RouteConfig(namespace): `path` must be a non empty string.");return this.namespaces[i]=new f({config:this.configManager.merge(this.config,this.configManager.set(t)),fullPath:n||D(u,this.fullPath),id:r||D(i,this.id,"."),key:i,namespaces:a,path:u,routes:c},this.options),this.keys.namespaces.includes(i)||this.keys.namespaces.push(i),this.namespaces[i]},e.route=function(e){var t=e.config,n=e.fullPath,r=e.id,i=e.key,o=e.path;if(n&&"string"!=typeof n)throw new TypeError("RouteConfig(route): `fullPath` must be a non empty string.");if(r&&"string"!=typeof r)throw new TypeError("RouteConfig(route): `id` must be a non empty string.");if("string"!=typeof i||""===i)throw new TypeError("RouteConfig(route): `key` must be a non empty string.");if(o&&"string"!=typeof o)throw new TypeError("RouteConfig(route): `path` must be a string.");var a={config:this.configManager.merge(this.config,this.configManager.set(t)),fullPath:n||D(o||"",this.fullPath),id:r||D(i,this.id,"."),key:i};return o&&(a.path=o),this.routes[i]=a,this.keys.routes.includes(i)||this.keys.routes.push(i),this},e.url=function(e,t,n){if(void 0===e&&(e="index"),void 0===t&&(t=void 0),void 0===n&&(n=void 0),"string"!=typeof e||""===e)throw new TypeError("RouteConfig(url): `key` must be a string.");var r=this._findRoute(e);if(!r)return null;var i=o.compile(r.fullPath);return t||n?i(t,n):r.fullPath},f}();F.fromNormalizedMap=function(e,t){var n=new I.Entity("routes"),r=new I.Entity("namespaces",{routes:[n]});r.define({namespaces:[r]});var i=function(e,t,n){if(void 0!==e)return $(n)(e,t)}(e.result,{namespaces:[r],routes:[n]},e.entities);return new F(function n(e){return c({},e,{namespaces:e.namespaces.reduce(function(e,t){return e[t.key]=n(t),e},{}),routes:e.routes.reduce(function(e,t){return e[t.key]=t,e},{})})}(i),t)},e.Config=t,e.RouteConfig=F,Object.defineProperty(e,"__esModule",{value:!0})});
